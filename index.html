<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>test</title>
    <link rel="stylesheet" href="assets/js/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <header>
        <div class="wrap">
            <h1>高雄旅遊資訊</h1>
            <select name="" id="selet-box">
                <option value="-1">-- 請選擇行政區 --</option>
            </select>
            <div class="hot-block">
                <p class="hot-title">熱門行政區</p>
                <div class="hot-content">
                    <ul>
                        <li class="hot1" value="18">苓雅區</li>
                        <li class="hot2" value="0">三民區</li>
                        <li class="hot3" value="17">新興區</li>
                        <li class="hot4" value="15">高雄市</li>
                    </ul>
                </div>
            </div>
        </div>
    </header>
    <main>
        <div class="wrap">
            <div class="line">
                <span class="circle"></span>
            </div>
            <div id="content-block">
                <div id="content-title">三民區</div>
                <div id="content">
                    <ul class="clearfix"></ul>
                </div>
            </div>
            <nav aria-label="Page navigation">
                <ul class="pagination d-flex justify-content-center" id="areaPage">
                    <li class="page-item"><a class="page-link" href="#">Previous</a></li>
                    <li class="page-item"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">Next</a></li>
                </ul>
            </nav>
        </div>
    </main>
    <footer>
        <div class="wrap">
            <p>高雄旅遊網</p>
            <p>資料來源 : 高雄市政府</p>
        </div>
    </footer>
</body>
<script src="assets/js/jquery-3.2.1.min.js"></script>
<script src="assets/js/bootstrap/js/bootstrap.min.js"></script>
<!-- <script src="assets/json/datastore_search.json"></script> -->
<script>
    var ogjData;
    var xhr = new XMLHttpRequest();
    xhr.open('get', 'https://data.kcg.gov.tw/api/action/datastore_search?resource_id=92290ee5-6e61-456f-80c0-249eae2fcc97', true);
    xhr.send(null);
    xhr.onload = function () {
        ogjData = JSON.parse(xhr.responseText);
        // console.log(ogjData.result.records)
        Index.init();
    };
    var index = function(){ 
        var id = 0;
        var val;
        // 初始資料        
        this.initial = function(){
            // 預設三民區
            $('#selet-box option[value="'+id+'"]').attr('selected','selected');
            val = $('#selet-box option[value="' + id + '"]').text();
        }
        this.domEvent = function(){
            var _this = this;
            $('#selet-box').on('change',function(){
                var text = $('#selet-box :selected').text();
                $('#content-title').text(text);
                _this.mainRender(text);  
            });
        }
        this.selectRender = function(){
            var _this = this;
            let html;
            let select      = [];
            let selectAry   = [];
            let selectData  = ogjData.result.records;
            // 只取區的value
            for( let i in selectData ){
                let zone = selectData[i].Zone;
                selectAry.push(zone);
                select = selectAry.filter(function (el, idx, arr) {
                    return arr.indexOf(el) === idx;
                });
            }
            for( let j=0; j < select.length; j++  ){
                html += `<option value="${j}">${select[j]}</option>`;
            }
            $('#selet-box').append(html);
        }   
        this.mainRender = function(val){
            let mainData = ogjData.result.records;
            let dataObj  = {};
            let html;
            $('#content ul').html('');
            for( let i in mainData ){
                if( mainData[i].Zone == val ){
                    html += `<li class="contentLi-style" data-id="${mainData[i]._id}">
                                <figcaption>
                                    <img src="${mainData[i].Picture1}"/>
                                    <figure class="name">${mainData[i].Name}</figure>
                                    <figure class="area">${mainData[i].Zone}</figure>
                                </figcaption>
                                <div class="contentText-block">
                                    <ul>
                                        <li class="area-time">${mainData[i].Opentime}</li>
                                        <li class="area-position">${mainData[i].Add}</li>
                                        <li class="area-phone">
                                            <div>${mainData[i].Tel}</div>
                                            <div class="area-tag">${mainData[i].Ticketinfo}</div>
                                        </li>
                                    </ul>
                                </div>
                            </li>`;
                    // 出現不名 undefined 移除
                    html = html.replace('undefined', '');
                }
            }
            $('#content ul').append(html);
        }
        this.init = function(){
            var _this = this;
            $(document).ready(function () {
                _this.selectRender();
                _this.initial();
                _this.mainRender(val);  
                _this.domEvent()   
            });
        }
    }
    var Index = new index();
</script>
</html>